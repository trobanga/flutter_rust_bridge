"use strict";(self.webpackChunkflutter_rust_bridge=self.webpackChunkflutter_rust_bridge||[]).push([[7147],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=d(n),c=a,f=m["".concat(s,".").concat(c)]||m[c]||u[c]||i;return n?r.createElement(f,o(o({ref:t},p),{},{components:n})):r.createElement(f,o({ref:t},p))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var d=2;d<i;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},793:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var r=n(7462),a=(n(7294),n(3905));const i={},o="Tips and procedures",l={unversionedId:"guides/contributing/tip",id:"guides/contributing/tip",title:"Tips and procedures",description:"How to add a test",source:"@site/docs/guides/contributing/tip.md",sourceDirName:"guides/contributing",slug:"/guides/contributing/tip",permalink:"/flutter_rust_bridge/guides/contributing/tip",draft:!1,editUrl:"https://github.com/fzyzcjy/flutter_rust_bridge/tree/master/website/docs/guides/contributing/tip.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/flutter_rust_bridge/guides/contributing/overview"},next:{title:"Submodules",permalink:"/flutter_rust_bridge/guides/contributing/submodules/"}},s={},d=[{value:"How to add a test",id:"how-to-add-a-test",level:2},{value:"How to solve failed CI",id:"how-to-solve-failed-ci",level:2},{value:"Tips for development",id:"tips-for-development",level:2},{value:"The <code>./frb_internal</code>",id:"the-frb_internal",level:3},{value:"The <code>just codegen</code>",id:"the-just-codegen",level:3},{value:"Check the dumped data",id:"check-the-dumped-data",level:3},{value:"Use <code>frb_example/dart_minimal</code> as testing bed",id:"use-frb_exampledart_minimal-as-testing-bed",level:3},{value:"Draw a flamegraph for performance",id:"draw-a-flamegraph-for-performance",level:2}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"tips-and-procedures"},"Tips and procedures"),(0,a.kt)("h2",{id:"how-to-add-a-test"},"How to add a test"),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"This package has some scripts to automatically create more tests based on the test you write,\nso you write one test and get (usually) six tests ;)"),(0,a.kt)("p",{parentName:"admonition"},"That's why adding a test seems slightly more complex than usual - but surely quicker than manually writing 6 tests.")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In ",(0,a.kt)("inlineCode",{parentName:"li"},"./frb_example/pure_dart"),",\nadd your test in (for example) ",(0,a.kt)("inlineCode",{parentName:"li"},"rust/src/api/whatever.rs")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"test/api/whatever_test.dart"),"."),(0,a.kt)("li",{parentName:"ol"},"Remember to mimic existing tests and add ",(0,a.kt)("inlineCode",{parentName:"li"},"_twin_normal"),"/",(0,a.kt)("inlineCode",{parentName:"li"},"TwinNormal"),'/etc as appropriate (this allows more "twin" tests to be generated).'),(0,a.kt)("li",{parentName:"ol"},"Run ",(0,a.kt)("inlineCode",{parentName:"li"},"./frbinternal precommit --mode slow"),", or if that's too slow,\nrun ",(0,a.kt)("inlineCode",{parentName:"li"},"./frb_internal generate-internal-frb-example-pure-dart && ./frb_internal generate-run-frb-codegen-command-generate --package frb_example/pure_dart"))),(0,a.kt)("h2",{id:"how-to-solve-failed-ci"},"How to solve failed CI"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"When it is merely flaky"),": Sometimes it is just flaky, not real bug. Thus, try to re-run the CI jobs\n(e.g. by pushing a commit that does no real work in order to trigger the CI) and see."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Quickly solve git-diff errors"),": If the CI is unhappy and provide you git diffs,\nyou can either run code generator locally, or directly ",(0,a.kt)("em",{parentName:"li"},"copy-and-paste")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"git apply")," those diffs to fix your code."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"How to reproduce locally"),": Operations are usually reproducible using corresponding ",(0,a.kt)("inlineCode",{parentName:"li"},"./frb_internal something")," commands shown in CI."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Automatic fix commands"),": For many ",(0,a.kt)("inlineCode",{parentName:"li"},"./frb_internal")," commands, there is a ",(0,a.kt)("inlineCode",{parentName:"li"},"--fix")," option which tries to automatically fix everything.")),(0,a.kt)("h2",{id:"tips-for-development"},"Tips for development"),(0,a.kt)("h3",{id:"the-frb_internal"},"The ",(0,a.kt)("inlineCode",{parentName:"h3"},"./frb_internal")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"./frb_internal whatever-command")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"./frb_internal.bat"),") delegates to the ",(0,a.kt)("inlineCode",{parentName:"p"},"./tools/frb_internal")," dart package.\nIt contains all scripts to work on flutter_rust_bridge development.\nIt as a similar role as ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casey/just/blob/master/justfile"},"justfile"),", makefile, etc.\nFor example, ",(0,a.kt)("inlineCode",{parentName:"p"},"./frb_internal precommit --mode fast")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"--mode slow"),") runs code generator, formatter, etc for you."),(0,a.kt)("h3",{id:"the-just-codegen"},"The ",(0,a.kt)("inlineCode",{parentName:"h3"},"just codegen")),(0,a.kt)("p",null,"To run the ",(0,a.kt)("inlineCode",{parentName:"p"},"flutter_rust_bridge_codegen"),", but using the local code (instead of a released version),\nplease replace it with ",(0,a.kt)("inlineCode",{parentName:"p"},"just codegen"),"."),(0,a.kt)("h3",{id:"check-the-dumped-data"},"Check the dumped data"),(0,a.kt)("p",null,"With ",(0,a.kt)("inlineCode",{parentName:"p"},"dump_all: true")," in the config (which is already done for ",(0,a.kt)("inlineCode",{parentName:"p"},"frb_example/pure_dart"),"),\nmany things are dumped into the ",(0,a.kt)("inlineCode",{parentName:"p"},"rust/target/frb_dump/")," folder,\nwhich is often helpful for debugging the codegen.\nFor example, you can check the effective configuration, the IR (intermediate representation),\nthe generated spec, the generated code, etc."),(0,a.kt)("h3",{id:"use-frb_exampledart_minimal-as-testing-bed"},"Use ",(0,a.kt)("inlineCode",{parentName:"h3"},"frb_example/dart_minimal")," as testing bed"),(0,a.kt)("p",null,"A lot of tests reside in ",(0,a.kt)("inlineCode",{parentName:"p"},"frb_example/pure_dart"),", thus it is a bit big and slow to compile and examine.\nTherefore, I (personally) often use ",(0,a.kt)("inlineCode",{parentName:"p"},"frb_example/dart_minimal")," as a testing bed."),(0,a.kt)("p",null,"For example, I will ad-hoc add one or two functions to dart_minimal when wanting to examine outputs and behavior."),(0,a.kt)("h2",{id:"draw-a-flamegraph-for-performance"},"Draw a flamegraph for performance"),(0,a.kt)("p",null,"If you are not working on improving performance, please ignore this subsection."),(0,a.kt)("p",null,"I have made some small scripts for me to get flamegraph on MacOS.\nThe scripts contain absolute paths, extra pieces for MacOS to work, etc.\nSo you can look at the source code and modify to suit your needs."),(0,a.kt)("p",null,"To execute it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"./frb_internal bench-flamegraph-compile\n./frb_internal bench-flamegraph-run --filter 'VoidFunction.*FrbCstSse.*false' --loop-count 10000000\n")))}u.isMDXComponent=!0}}]);